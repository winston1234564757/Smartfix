generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Product {
  id               String        @id @default(cuid())
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  
  title            String
  slug             String        @unique
  brand            String
  model            String
  description      String?
  price            Decimal
  purchaseCost     Decimal       @default(0)
  repairCost       Decimal       @default(0)
  
  images           String[]
  status           ProductStatus @default(AVAILABLE)
  
  arrivalDate      DateTime?
  estimatedArrival DateTime?
  quantity         Int           @default(1)

  category         Category
  grade            Grade
  storage          String
  color            String
  
  // SPECS
  cpu              String?
  ram              String?
  gpu              String?
  screenSize       String?
  
  checklist        Json?
  upgrades         Json?

  orderItems       OrderItem[]
  requests         ProductRequest[]
}

model Order {
  id             String      @id @default(cuid())
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  status         String      @default("PENDING")
  total          Decimal
  customerName   String
  phone          String
  city           String      @default("")
  warehouse      String      @default("")
  internalNotes  String?     @db.Text
  warrantyType   String      @default("BASIC")
  warrantyPrice  Decimal     @default(0)
  userId         String?
  items          OrderItem[]
}

model OrderItem {
  id             String   @id @default(cuid())
  orderId        String
  order          Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId      String
  product        Product  @relation(fields: [productId], references: [id])
  quantity       Int      @default(1)
  price          Decimal
  selectedOptions String[] 
}

model ServiceDevice {
  id        String        @id @default(cuid())
  name      String
  brand     String
  type      Category
  image     String?
  services  ServiceItem[]
}

model ServiceItem {
  id        String        @id @default(cuid())
  title     String
  price     Decimal
  duration  String
  partCost  Decimal       @default(0)
  deviceId  String
  device    ServiceDevice @relation(fields: [deviceId], references: [id], onDelete: Cascade)
}

model ServiceAddon {
  id          String   @id @default(cuid())
  label       String
  price       Decimal
  description String?
  category    Category
  isPopular   Boolean  @default(false)
}

model RepairOrder {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  status        String   @default("NEW")
  deviceName    String
  serviceName   String
  addons        Json?
  price         Decimal
  cost          Decimal  @default(0)
  customerName  String
  phone         String
  userId        String?
  images        String[]
  internalNotes String?  @db.Text
}

model TradeInRequest {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  model     String
  storage   String
  condition String
  images    String[]
  name      String
  phone     String
  userId    String?
  status    String   @default("NEW")
}

model ProductRequest {
  id             String   @id @default(cuid())
  createdAt      DateTime @default(now())
  targetProduct  String
  budget         String
  desiredStorage String?
  desiredColor   String?
  desiredGrade   String?
  
  // Tech Specs
  desiredCpu     String?
  desiredRam     String?
  desiredGpu     String?
  desiredScreen  String?
  clientNotes    String?

  customerName   String
  phone          String
  userId         String?
  status         String   @default("NEW")
  offeredProductId String?
  offeredProduct   Product? @relation(fields: [offeredProductId], references: [id])
}

model PromoBanner {
  id        String   @id @default(cuid())
  title     String
  subtitle  String?
  image     String
  link      String
  size      String   @default("STANDARD")
  order     Int      @default(0)
}

model CategoryMetadata {
  id          String @id
  imageUrl    String
  description String
  color       String
  buttonText  String
}

enum ProductStatus {
  AVAILABLE
  SOLD
  RESERVED
  REPAIR
  PRE_ORDER
  ON_REQUEST
}

enum Category {
  IPHONE
  ANDROID
  TABLET
  LAPTOP
  WATCH
  ACCESSORY
  OTHER
}

enum Grade {
  NEW
  A_PLUS
  A
  B
  C
  D
}